# Ensure you have an A record pointing yourdomain.com to your server's public IP.
# Caddy will automatically provision and renew Let's Encrypt certificates. 
localhost {
    # Enable compression
    encode gzip

    # Route requests to the Next.js frontend service (running on port 3000 internally)
    # Caddy handles adding necessary proxy headers
    reverse_proxy frontend:3000

    # Recommended headers for security
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "interest-cohort=()"
        # Remove Caddy's default Server header (optional obfuscation)
        -Server
    }
}

# Optional: Redirect www to non-www (or vice-versa)
# www.yourdomain.com {
#    redir https://yourdomain.com{uri} permanent
# }
